<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poster Archive</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-muted: #888888;
            --accent: #009688; /* Teal to match your main site */
            --accent-glow: rgba(0, 150, 136, 0.2);
            --border: #333333;
            --hover-bg: #2a2a2a;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Courier New', Courier, monospace;
            margin: 0;
            padding: 40px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header Styling */
        header {
            border-bottom: 2px solid var(--accent);
            padding-bottom: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        h1 {
            margin: 0;
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent-glow);
        }

        .breadcrumb {
            font-size: 14px;
            color: var(--text-muted);
        }

        .breadcrumb span {
            color: var(--text-main);
            cursor: pointer;
        }
        
        .breadcrumb span:hover {
            text-decoration: underline;
            color: var(--accent);
        }

        /* File List Styling */
        .file-list {
            list-style: none;
            padding: 0;
            margin: 0;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-main);
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-item:hover {
            background-color: var(--hover-bg);
            padding-left: 25px;
            border-left: 3px solid var(--accent);
        }

        /* Icons */
        .icon {
            font-size: 20px;
            width: 40px;
            text-align: center;
            margin-right: 15px;
        }

        .fa-folder { color: #ffd700; }
        .fa-file-pdf { color: #ff5252; }
        .fa-file-code { color: var(--accent); }
        .fa-reply { color: var(--text-muted); }

        /* Text Details */
        .file-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .name {
            font-size: 16px;
            font-weight: bold;
        }

        .meta {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Action Arrow */
        .arrow {
            opacity: 0;
            color: var(--accent);
            transform: translateX(-10px);
            transition: all 0.2s ease;
        }

        .file-item:hover .arrow {
            opacity: 1;
            transform: translateX(0);
        }

        /* Loading State */
        .loader {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
            font-style: italic;
        }
        
        .error-msg {
            color: #ff5252;
            text-align: center;
            padding: 20px;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div>
                <h1><i class="fa-solid fa-file-invoice"></i> Poster Archive</h1>
                <div style="margin-top: 10px; color: var(--text-muted); font-size: 12px;">
                    Browsing: shayokdutta.github.io/posters
                </div>
            </div>
            <div class="breadcrumb" id="breadcrumb">
            </div>
        </header>

        <ul class="file-list" id="file-list">
            <li class="loader">Scanning repository...</li>
        </ul>
    </div>

    <script>
        // ================= CONFIGURATION =================
        const USERNAME = 'shayokdutta'; 
        const REPO = 'shayokdutta.github.io';
        const BRANCH = 'master'; 
        const BASE_PATH = 'posters'; 
        // =================================================

        const listElement = document.getElementById('file-list');
        const breadcrumbElement = document.getElementById('breadcrumb');
        
        // Track current path relative to repo root
        let currentPath = BASE_PATH;

        // Init
        fetchDirectory(currentPath);

        // Function to fetch GitHub Content
        async function fetchDirectory(path) {
            listElement.innerHTML = '<li class="loader">Scanning /' + path + ' ...</li>';
            updateBreadcrumb(path);

            try {
                const response = await fetch(`https://api.github.com/repos/${USERNAME}/${REPO}/contents/${path}?ref=${BRANCH}`);
                
                if (!response.ok) {
                    if(response.status === 404) throw new Error("Folder not found. Make sure the path exists.");
                    throw new Error(`GitHub API Error: ${response.status}`);
                }

                let data = await response.json();
                
                // If the API returns an object (single file) instead of array, wrap it
                let files = Array.isArray(data) ? data : [data];

                // === FILTER STEP ADDED HERE ===
                files = files.filter(f => f.name.toLowerCase() !== 'index.html');
                // ==============================
                
                renderList(files, path);
                currentPath = path;

            } catch (error) {
                listElement.innerHTML = `<li class="error-msg"><i class="fa-solid fa-circle-exclamation"></i> ${error.message}</li>`;
                console.error(error);
            }
        }

        // Render the list of files
        function renderList(files, path) {
            listElement.innerHTML = '';

            // 1. Add "Go Back" folder if not at root BASE_PATH
            if (path !== BASE_PATH) {
                const li = document.createElement('li');
                li.className = 'file-item';
                li.innerHTML = `
                    <div class="icon"><i class="fa-solid fa-reply"></i></div>
                    <div class="file-info"><span class="name">.. (Parent Directory)</span></div>
                `;
                li.onclick = () => {
                    // Prevent going higher than BASE_PATH
                    if(path === BASE_PATH) return;
                    
                    const parentPath = path.substring(0, path.lastIndexOf('/'));
                    fetchDirectory(parentPath);
                };
                listElement.appendChild(li);
            }

            // Sort: Folders first, then files
            files.sort((a, b) => {
                if (a.type === b.type) return a.name.localeCompare(b.name);
                return a.type === 'dir' ? -1 : 1;
            });

            // 2. Render Items
            files.forEach(file => {
                const li = document.createElement('li'); 
                
                let icon = 'fa-file-code';
                
                if (file.type === 'dir') {
                    icon = 'fa-folder';
                    li.onclick = () => fetchDirectory(file.path);
                } else {
                    if (file.name.toLowerCase().endsWith('.pdf')) icon = 'fa-file-pdf';
                    else if (file.name.toLowerCase().match(/\.(jpg|jpeg|png|svg)$/)) icon = 'fa-file-image';
                    
                    // Logic for User Page URL generation
                    let pagesUrl;
                    if (REPO.toLowerCase() === `${USERNAME.toLowerCase()}.github.io`) {
                        // For User Pages: https://username.github.io/path/to/file
                        pagesUrl = `https://${REPO}/${file.path}`;
                    } else {
                        // For Project Pages: https://username.github.io/repo/path/to/file
                        pagesUrl = `https://${USERNAME}.github.io/${REPO}/${file.path}`;
                    }
                    
                    li.onclick = () => window.open(pagesUrl, '_blank');
                }

                li.className = 'file-item';
                li.innerHTML = `
                    <div class="icon"><i class="fa-solid ${icon}"></i></div>
                    <div class="file-info">
                        <span class="name">${file.name}</span>
                        <span class="meta">${file.type === 'dir' ? 'Folder' : (file.size / 1024).toFixed(1) + ' KB'}</span>
                    </div>
                    <div class="arrow"><i class="fa-solid fa-chevron-right"></i></div>
                `;
                listElement.appendChild(li);
            });
            
            if (files.length === 0) {
                listElement.innerHTML = '<li class="loader">Empty Directory</li>';
            }
        }

        // Update Breadcrumb UI
        function updateBreadcrumb(path) {
            // Remove the base path from display to make it look cleaner
            let relativePath = path;
            if (path.startsWith(BASE_PATH)) {
                relativePath = path.substring(BASE_PATH.length);
                if(relativePath.startsWith('/')) relativePath = relativePath.substring(1);
            }

            const parts = relativePath.split('/').filter(p => p);
            
            let html = '';
            let buildPath = BASE_PATH;
            
            parts.forEach((part, index) => {
                buildPath += '/' + part;
                const clickPath = buildPath; // Capture current state for closure
                
                if (index === parts.length - 1) {
                    html += ` / <span style="color:var(--accent); text-decoration:none; cursor:default;">${part}</span>`;
                } else {
                    // Create a clickable span
                    html += ` / <span onclick="fetchDirectory('${clickPath}')">${part}</span>`;
                }
            });

            breadcrumbElement.innerHTML = `<span onclick="fetchDirectory('${BASE_PATH}')"><i class="fa-solid fa-home"></i> Posters</span>${html}`;
        }
    </script>
</body>
</html>